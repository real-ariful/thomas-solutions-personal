<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <data>
        <record model="ir.ui.view" id="thomas_vehicle_view_form">
            <field name="name">thomas.vehicle.form</field>
            <field name="model">fleet.vehicle</field>
            <field name="inherit_id" ref="fleet.fleet_vehicle_view_form"/>
            <field name="arch" type="xml">
                <xpath expr="//header" position="inside">
                    <button name="check_update_portractor" string="Update Protractor" type="object" class="btn-primary" groups="fleet.fleet_group_manager"/>
                </xpath>
                <div class="oe_button_box" position="inside">
                    <button name="act_show_vehicle_lease_agreements"
                            type="object"
                            class="oe_stat_button"
                            icon="fa-book"
                            help="Show all the Rental Agreements for this vehicle"
                            groups="fleet.fleet_group_manager">
                        <field name="lease_agreements_count" widget="statinfo" string="Rental Agreements"/>
                    </button>
                    <button name="act_show_vehicle_lease_invoices"
                            type="object"
                            class="oe_stat_button"
                            icon="fa-book"
                            help="Show all the Rental Invoices for this vehicle"
                            groups="fleet.fleet_group_manager">
                        <field name="lease_invoices_count" widget="statinfo" string="Rental Invoices"/>
                    </button>
                    <button name="act_get_workorders"
                            type="object"
                            class="oe_stat_button"
                            icon="fa-wrench"
                            help="Show all the Protractor Service Invoices for this vehicle"
                            groups="fleet.fleet_group_manager">
                            <field name="workorder_invoices_count" widget="statinfo" string="Work Orders"/>
                    </button>
                    <button name="act_show_vehicle_photos"
                            type="object"
                            class="oe_stat_button"
                            icon="fa-flask"
                            help="Show all the Photographs for this vehicle"
                            string="Vehicle Pictures">
                    </button>
                    <!-- <button name="return_action_to_open"
                            type="object"
                            class="oe_stat_button"
                            icon="fa-flask"
                            context="{'xml_id':'fleet_vehicle_log_fuel_action'}"
                            help="show the fuel logs for this vehicle">
                        <field name="fuel_logs_count" widget="statinfo" string="Fuel"/>
                    </button> -->
                    <button name="return_action_to_open"
                            type="object"
                            class="oe_stat_button"
                            icon="fa-tachometer"
                            context="{'xml_id':'fleet_vehicle_odometer_action'}"
                            help="show the odometer logs for this vehicle">
                        <field name="odometer_count" widget="statinfo" string="Odometer"/>
                    </button>
                    <button name="toggle_active" type="object" class="oe_stat_button" icon="fa-archive">
                        <field name="active" widget="boolean_button" options='{"terminology": "archive"}'/>
                    </button>
                </div>
                <div class="oe_title" position="replace">
                    <div class="oe_title">
                        <h1>
                            <field name="unit_slug" class="oe_read_only"/>
                            <br/>
                        </h1>

                        <label for="unit_no"/>
                        <div class="oe_edit_only">
                            <field name="unit_no"></field>
                            <br/>
                        </div>
                        <label for="vin_id"/>
                        <field name="vin_id"></field>
                        <br/>
                        <label for="license_plate"/>
                        <field name="license_plate"/>
                        <br/>
                    </div>
                </div>
                <div class="oe_title" position="after">
                    <group col="3">
                        <group>
                            <field name="unit_quality"/>
                        </group>
                        <group>
                            <field name="lease_status"/>
                        </group>
                        <group>
                            <field name="fleet_status"/>
                        </group>
                    </group>
                </div>
                <!-- <xpath expr="//form[1]" position="replace">
                    <form string="Vehicle">
                        <sheet>
                            <div class="oe_title">
                                <h1>
                                    <field name="unit_slug" class="oe_read_only"/>
                                    <br/>
                                </h1>

                                <label for="unit_no"/>
                                <div class="oe_edit_only">
                                    <field name="unit_no"></field>
                                    <br/>
                                </div>
                                <label for="vin_id"/>
                                <field name="vin_id"></field>
                                <br/>
                                <label for="license_plate"/>
                                <field name="license_plate"/>
                                <br/>
                            </div>
                            <group col="3">
                                <group>
                                    <field name="unit_quality"/>
                                </group>
                                <group>
                                    <field name="lease_status"/>
                                </group>
                                <group>
                                    <field name="fleet_status"/>
                                </group>
                            </group>
                        </sheet>
                        <div class="oe_chatter">
                            <field name="message_follower_ids" widget="mail_followers"/>
                            <field name="message_ids" widget="mail_thread"/>
                        </div>
                    </form> -->

                <xpath expr="//notebook//page[1]" position="before">
                    <page string="Unit Specs">
                        <group col="2">
                            <group>
                                <field name="brand_id" options="{'no_open':True, 'no_create':True}"/>
                                <field name="model_id" options="{'no_open':True, 'no_create':True}"/>
                                <field name="trim_id"  options="{'no_open':True, 'no_create':True}"/>
                                <field name="model_year"/>
                                <field name="engine"/>
                                <field name="transmission"/>
                                <field name="fuel_type" options="{'no_open':True}"/>
                                <field name="drive"/>
                                <field name="body_style"/>
                                <field name="doors"/>
                                <field name="seats"/>
                                <field name="seat_belts"/>
                                <field name="color"/>
                                <label for="odometer"/>
                                <div class="o_row">
                                    <field name="odometer"/>
                                    <field name="odometer_unit"/>
                                </div>
                            </group>
                            <group>
                                <br></br>
                                <field name="location" widget="selection" options="{'no_open':True, 'no_create_edit': True}"/>
                                <field name="door_access_code"></field>
                                <field name="wheel_studs"/>
                                <field name="wheel_base"/>
                                <field name="box_size"/>
                                <field name="seat_material" options="{'no_open':True, 'no_create_edit': True}"/>
                                <field name="flooring" options="{'no_open':True, 'no_create_edit': True}"/>
                                <field name="trailer_hitch"/>
                                <field name="brake_controller"/>
                                <field name="tires"/>
                                <field name="rim_bolts"/>
                                <field name="capless_fuel_filler"/>
                                <field name="bluetooth"/>
                                <field name="navigation"/>
                            </group>
                        </group>
                        <group>
                            <field name="inclusions" widget="many2many_tags"/>
                            <field name="accessories" context="{'unit':True}" >
                                <tree>
                                    <field name="unit_no"/>
                                    <field name="name"/>
                                    <field name="description"/>
                                    <field name="thomas_purchase_price"/>
                                </tree>
                            </field>
                        </group>
                    </page>

                    <page string="Notes">
                        <group colspan="4">
                            <group>
                                <field name="qc_check"/>
                                <field name="fin_check"/>
                                <field name="protractor_guid"/>
                                <field name="stored_protractor_guid"/>
                                <field name="protractor_owner_guid"/>
                                <field name="warranty_start_date"/>
                                <field name="charge_code"/>
                            </group>
                            <group>
                                <field name="notes"/>
                                <field name="tag_ids" widget="many2many_tags"
                                        options="{'color_field': 'color', 'no_create_edit': True}"/>
                            </group>
                        </group>
                    </page>

                    <page string="Financial History">
                        <group colspan="4">
                            <group>
                                <field name="historical_revenue"/>
                                <field name="revenue_to_date"/>
                                <field name="maintenance_cost_to_date"/>
                                <field name="insurance_cost_to_date"/>
                                <field name="licensing_cost_to_date"/>
                                <field name="all_cost"/>
                                <field name="reporting_profit"/>
                                <field name="lifetime_profit"/>
                                <field name="profitability_ratio"/>
                                <field name="thomas_purchase_price"/>
                                <field name="betterment_cost"/>
                                <field name="purchase_date"/>
                                <field name="asset_class"/>
                                <field name="insurance_class"/>
                                <field name="charge_code"/>
                            </group>
                            <group>
                                <field name="filed_as"/>
                                <field name="company_acct"/>
                                <field name="usage"/>
                                <field name="fleet_status"/>
                                <field name="disposal_year"/>
                                <field name="disposal_date"/>
                                <field name="disposal_proceeds"/>
                                <field name="sold_to"/>
                            </group>
                            <h2>Invoices</h2>
                            <field name="lease_invoice_ids" options="{'no_create': True}" readonly="1">
                                <tree decoration-info="state == 'draft'"
                                        decoration-muted="state == 'cancel'"
                                        string="Invoice">
                                    <field name="partner_id" groups="base.group_user" string="Customer"/>
                                    <field name="invoice_date"/>
                                    <field name="commercial_partner_id" invisible="1"/>
                                    <field name="ref" invisible="1"/>
                                    <field name="name" invisible="1"/>
                                    <field name="journal_id" invisible="1"/>
                                    <field name="company_id" groups="base.group_multi_company"
                                            options="{'no_create': True}"/>
                                    <field name="user_id"/>
                                    <field name="invoice_date_due"/>
                                    <field name="invoice_origin"/>
                                    <field name="amount_total_signed" string="Total" sum="Total"/>
                                    <field name="amount_residual_signed" string="Amount Due" sum="Amount Due"/>
                                    <field name="currency_id" invisible="1"/>
                                    <field name="company_currency_id" invisible="1"/>
                                    <field name="state"/>
                                </tree>
                            </field>
                        </group>
                    </page>
                    
                    <page string="Revenue" groups="thomasfleet.fleet_group_admin">
                        <group>
                            <field name="historical_revenue"/>
                            <field name="revenue_to_date"/>
                        </group>
                        <h2>Line Item Revenue</h2>
                        <field name="line_items" options="{'no_create': True}" readonly="1">
                            <tree>
                                <field name="invoice_date"/>
                                <field name="invoice_id" string="Invoice"/>
                                <field name="partner_id" string="Customer"/>
                                <field name="name"/>
                                <field name="quantity"/>
                                <field name="price_unit"/>
                                <field name="price_total" sum="Total Revenue"/>
                            </tree>
                        </field>
                    </page>
                </xpath>
            </field>
        </record>

        <record model="ir.ui.view" id="thomas_vehicle_view_tree">
            <field name="name">thomas.vehicle.tree</field>
            <field name="model">fleet.vehicle</field>
            <field name="inherit_id" ref="fleet.fleet_vehicle_view_tree"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='model_id']" position="before">
                    <field name="unit_no"></field>
                    <field name="brand_id"/>
                </xpath>
                <xpath expr="//field[@name='license_plate']" position="replace">
                </xpath>
                <xpath expr="//field[@name='model_id']" position="after">
                    <field name="trim_id"></field>
                    <field name="color"></field>
                    <field name="vin_id"></field>
                    <field name="license_plate"></field>
                    <field name="fleet_status"/>
                    <field name="location"></field> 
                </xpath>
                <xpath expr="//field[@name='driver_id']" position="attributes">
                    <attribute name="optional">True</attribute>
                </xpath>
                <xpath expr="//field[@name='future_driver_id']" position="attributes">
                    <attribute name="optional">True</attribute>
                </xpath>
                <xpath expr="//field[@name='acquisition_date']" position="attributes">
                    <attribute name="optional">True</attribute>
                </xpath>
                <xpath expr="//field[@name='tag_ids']" position="attributes">
                    <attribute name="optional">True</attribute>
                </xpath>
                <!-- <xpath expr="//field[@name='license_plate']" position="before">
                    <field name="unit_no"></field>
                    <field name="brand_id"/>
                    <field name="model_id"></field>
                    <field name="trim_id"></field>
                    <field name="color"></field>
                    <field name="vin_id"></field>
                    <field name="license_plate"></field>
                    <field name="fleet_status"/>
                    <field name="location"></field> 
                </xpath> -->
            </field>
        </record>

        <record id='thomas_vehicle_view_kanban' model='ir.ui.view'>
            <field name="name">thomas.vehicle.kanban</field>
            <field name="model">fleet.vehicle</field>
            <field name="inherit_id" ref="fleet.fleet_vehicle_view_kanban"/>
            <field name="arch" type="xml">
                <xpath expr="//kanban[1]" position="replace">
                    <kanban>
                        <field name="unit_slug"/>
                        <field name="unit_no"/>
                        <field name="license_plate"/>
                        <field name="brand_id"/>
                        <field name="model_id"/>
                        <field name="model_id"/>
                        <field name="driver_id"/>
                        <field name="location"/>
                        <field name="state_id"/>
                        <field name="id"/>
                        <field name="tag_ids"/>
                        <field name="fleet_status"/>
                        <templates>
                            <t t-name="kanban-box">
                                <div class="oe_kanban_global_click">
                                    <div class="o_kanban_image">
                                        <img t-att-src="kanban_image('fleet.vehicle', 'image_medium', record.id.raw_value)" alt="Asset Image"/>
                                    </div>
                                    <div class="oe_kanban_details">
                                        <t t-log="record.fleet_status.value"/>
                                        <strong class="o_kanban_record_title">
                                            <t t-if="!record.fleet_status.raw_value">
                                                <span t-att-style="'color:green'">
                                                    <field name="unit_slug"/>
                                                </span>
                                            </t>
                                            <t t-if="record.fleet_status.raw_value">
                                                <span>
                                                    <field name="unit_slug"/>
                                                </span>
                                            </t>
                                        </strong>
                                        <div>
                                            Plate:
                                            <field name="license_plate"/>
                                        </div>
                                        <div class="o_kanban_tags_section">
                                            <field name="tag_ids" widget="many2many_tags"
                                                   options="{'color_field': 'color'}"/>
                                        </div>
                                        <ul>
                                            <li>
                                                <t t-if="record.driver_id.raw_value">
                                                    <field name="driver_id"/>
                                                </t>
                                            </li>
                                            <li>
                                                <t t-if="record.location.raw_value">
                                                    <field name="location"/>
                                                </t>
                                            </li>
                                        </ul>
                                    </div>
                                    <div class="o_kanban_button">
                                        <a t-if="record.contract_count.raw_value>0" data-type="object"
                                           data-name="return_action_to_open" href="#"
                                           class="oe_kanban_action oe_kanban_action_a"
                                           data-context='{"xml_id":"fleet_vehicle_log_contract_action","search_default_open": 1}'>
                                            <field name="contract_count"/>
                                            Contract(s)
                                            <span t-if="record.contract_renewal_due_soon.raw_value and !record.contract_renewal_overdue.raw_value"
                                                  class="fa fa-exclamation-triangle" t-att-style="'color:orange'">
                                            </span>
                                            <span t-if="record.contract_renewal_overdue.raw_value"
                                                  class="fa fa-exclamation-triangle" t-att-style="'color:red;'">
                                            </span>
                                        </a>
                                    </div>
                                </div>
                            </t>
                        </templates>
                    </kanban>
                </xpath>
            </field>
        </record>

        <record id="thomas_vehicle_profit_pivot_view" model="ir.ui.view">
            <field name="model">fleet.vehicle</field>
            <field name="arch" type="xml">
                <pivot>
                    <field name="unit_no" type="row" />
                    <field name="maintenance_cost_to_date" type="measure"/>
                    <field name="all_cost" type="measure"/>
                    <field name="revenue_to_date" type="measure"/>
                    <field name="reporting_profit" type="measure"/>
                    <field name="lifetime_profit" type="measure"/>
                    <field name="profitability_ratio" type="measure"/>
                </pivot>
            </field>
        </record>


        <record id='thomas_vehicle_profit_pivot_action' model='ir.actions.act_window'>
            <field name="name">Vehicles Profitability Report</field>
            <field name="res_model">fleet.vehicle</field>
            <field name="view_mode">pivot</field>
            <field name="view_id" ref="thomas_vehicle_profit_pivot_view"/>
        </record>

        <menuitem action="thomas_vehicle_profit_pivot_action" parent="fleet.menu_fleet_reporting" id="thomas_vehicle_profit_pivot_menu"
                  sequence="8" groups="thomasfleet.fleet_group_admin"/>
        
        <record id="thomas_vehicle_view_search" model="ir.ui.view">
            <field name="name">thomas.vehicle.search</field>
            <field name="model">fleet.vehicle</field>
            <field name="inherit_id" ref="fleet.fleet_vehicle_view_search"></field>
            <field name="arch" type="xml">
                <xpath expr="//search[1]" position="replace">
                    <search string="All vehicles">
                        <field name="unit_no"></field>
                        <field name="vin_id"></field>
                        <field name="brand_id"></field>
                        <field name="model_id"></field>
                        <field name="trim_id"></field>
                        <field name="license_plate"></field>
                        <field name="tag_ids"/>
                        <field name="location"/>
                        <field name="state_id"/>
                        <field name="fleet_status"/>
                        <separator/>
                        <filter string="Archived" name="inactive" domain="[('active','=',False)]"/>
                        <group expand="1" string="Group By">
                            <filter name="groupby_status" context="{'group_by' : 'fleet_status'}" string="Status"/>
                            <filter name="groupby_model" context="{'group_by' : 'model_id'}" string="Model"/>
                        </group>
                    </search>
                </xpath>
            </field>
        </record>


    </data>
</odoo>
